<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>部署文档-文档</title>
 <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../dist/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="../dist/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../dist/css/AdminLTE.css">
  <link rel="stylesheet" href="../dist/css/common.css">
  <link rel="stylesheet" href="../dist/css/skins/_all-skins.min.css">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="../dist/js/html5shiv.js"></script>
  <script src="../dist/js/respond.min.js"></script>
  <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <header class="main-header">
    <!-- Logo -->
    <a href="index.html" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini">BL</span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg">日志系统</span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
      </a>
     <ul class="nav navbar-nav log-menu">
            <li>
              <a href="../index.html" target="_self">
                <button class="btn btn-block btn-success btn-flat" id="nav_application">
                  <i class="fa fa-signal"></i>应用
                </button>
              </a>
            </li>
            <li>
              <a href="../Mobile/mobile.html">
                <button class="btn btn-block btn-flat btn-twitter" id="nav_mobile">
                  <i class="menu-icon glyphicon glyphicon-phone"></i>移动
                </button>
              </a>
            </li>
            <li>
              <a href="../Browser/browser.html">
                <button class="btn btn-block btn-flat btn-warning" id="nav_browser">
                  <i class="fa fa-users"></i>浏览器
                </button>
              </a>
            </li>
            <li>
              <a href="../Servers/servers.html">
                <button class="btn btn-block btn-flat bg-purple" id="nav_server">
                  <i class="fa fa-cogs"></i>服务器
                </button>
              </a>
            </li>
            <li>
              <a href="../configs/configs.html">
                <button class="btn btn-block btn-flat bg-navy" id="nav_config">
                  <i class="fa fa-fw fa-adjust"></i>配置
                </button>
              </a>
            </li>
            <li class="active">
              <a href="documents.html">
                <button class="btn btn-block btn-flat bg-aqua" id="nav_document">
                  <i class="fa fa-fw fa-database"></i>文档
                </button>
              </a>
            </li>
          </ul>
      <div class="pull-right">
        <a class="log-exit"><i class="fa fa-sign-out"></i></a>
      </div>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- Sidebar user panel -->
      <div class="user-panel">
        <div class="pull-left image">
          <img src="../dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
        </div>
        <div class="pull-left info">
          <p>亚历山大·皮尔斯</p>
          <a href="#"><i class="fa fa-circle text-success"></i> 在线</a>
        </div>
      </div>
      
      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu">
        <li class="header">主导航</li>
         <li class="treeview">
          <a href="documents.html">
            <i class="glyphicon glyphicon-home"></i> <span>项目首页</span> 
          </a>
        </li>
        <li class="treeview">
          <a href="version-description.html">
            <i class="glyphicon glyphicon-book"></i>
            <span>版本说明</span>
          </a>
        </li>
        <li class="active treeview">
          <a href="documents-deployment.html">
            <i class="fa fa-cogs"></i>
            <span>部署文档</span>
          </a>
        </li>
        <li class="treeview">
          <a href="documents-integrated.html">
            <i class="fa fa-cutlery"></i>
            <span>集成文档</span>
          </a>
        </li>
         <li class="treeview">
          <a href="application-monitoring.html">
            <i class="fa fa-users"></i>
            <span>应用监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="mobile-monitor.html">
            <i class="glyphicon glyphicon-phone"></i>
            <span>移动监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="browser-monitor.html">
            <i class="fa fa-globe"></i>
            <span>浏览器监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="server-monitor.html">
            <i class="fa fa-desktop"></i>
            <span>服务端监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="alarm-document.html">
            <i class="fa fa-bell"></i>
            <span>告警文档</span>
          </a>
        </li>
        <li class="treeview">
          <a href="interface-document.html">
            <i class="glyphicon glyphicon-align-left"></i>
            <span>接口文档</span>
          </a>
        </li>
        <li class="treeview">
          <a href="developer-document.html">
            <i class="glyphicon glyphicon-refresh"></i>
            <span>开发者文档</span>
          </a>
        </li>
         <li class="treeview">
          <a href="common-problem.html">
            <i class="fa fa-inbox"></i>
            <span>常见问题</span>
          </a>
        </li>
         <li class="treeview">
          <a href="plug-in.html">
            <i class="fa fa-key"></i>
            <span>插件扩展</span>
          </a>
        </li>

      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        部署文档
        <small>Deployment Document</small>
      </h1>
    </section>

    <!-- Main content -->
    <section class="content invoice">
      <h2 class="page-header">
        <i class="fa fa-globe"></i> 生产环境部署
      </h2>
      <ol class="dep">
        <li>配置生产环境数据库，数据库脚本在资源文件 scrip/Cat.sql。</li>
        <li>准备N台cat服务器，比如3台，ip为10.1.1.1，10.1.1.2，10.1.1.3。</li>
        <li>在所有cat服务器上安装tomcat，启动端口默认设定为8080。<br />
            tomcat启动参数参考：-Xms20288m -Xmx20288m -XX:PermSize=256m -XX:MaxPermSize=256m -XX:NewSize=10144m -XX:MaxNewSize=10144m -XX:SurvivorRatio=10
        </li>
        <li>确保所有cat客户端以及服务器对于/data目录具有读写权限。</li>
        <li>配置所有客户端和服务端的配置文件client.xml，文件路径/data/appdatas/cat/client.xml。</li>
        <pre class="hljs scala">
          &lt;config mode="client"&gt;
                &lt;servers>
                          &lt;server ip="10.1.1.1" port="2280" http-port="8080"/&gt;
                          &lt;server ip="10.1.1.2" port="2280" http-port="8080"/&gt;
                          &lt;server ip="10.1.1.3" port="2280" http-port="8080"/&gt;
                &lt;/servers&gt;
          &lt;/config&gt;
        </pre>
        <li>配置服务端的数据库配置datasources.xml，文件路径/data/appdatas/cat/datasources.xml,需要替换对应的线上配置。</li>
        <pre class="hljs scala">
          &lt;data-sources&gt;
            &lt;data-source id="cat"&gt;
              &lt;maximum-pool-size&gt;3&lt;/maximum-pool-size&gt;
              &lt;connection-timeout&gt;1s&lt;/connection-timeout&gt;
              &lt;idle-timeout&gt;10m&lt;/idle-timeout&gt;
              &lt;statement-cache-size&gt;1000&lt;/statement-cache-size&gt;
              &lt;properties&gt;
                &lt;driver&gt;com.mysql.jdbc.Driver&lt;/driver&gt;
                &lt;url&gt;&lt;![CDATA[{jdbc.url}]]&gt;&lt;/url&gt;
                &lt;user&gt;{jdbc.user}&lt;/user&gt;
                &lt;password&gt;{jdbc.password}&lt;/password&gt;
                &lt;connectionProperties&gt;&lt;![CDATA[useUnicode=true&autoReconnect=true]]&gt;&lt;/connectionProperties&gt;
              &lt;/properties&gt;
            &lt;/data-source&gt;
            &lt;data-source id="app"&gt;
              &lt;maximum-pool-size&gt;3&lt;/maximum-pool-size&gt;
              &lt;connection-timeout&gt;1s&lt;/connection-timeout&gt;
              &lt;idle-timeout&gt;10m&lt;/idle-timeout&gt;
              &lt;statement-cache-size&gt;1000&lt;/statement-cache-size&gt;
              &lt;properties&gt;
                &lt;driver&gt;com.mysql.jdbc.Driver&lt;/driver&gt;
                &lt;url&gt;&lt;![CDATA[{jdbc.url}]]&gt;&lt;/url&gt;
                &lt;user&gt;{jdbc.user}&lt;/user&gt;
                &lt;password&gt;{jdbc.password}&lt;/password&gt;
                &lt;connectionProperties&gt;&lt;![CDATA[useUnicode=true&autoReconnect=true]]&gt;&lt;/connectionProperties&gt;
              &lt;/properties&gt;
            &lt;/data-source&gt;
          &lt;/data-sources&gt;
        </pre>
        <li>配置服务端的server.xml，文件路径/data/appdatas/cat/server.xml。</li>
        <pre class="hljs scala">
&lt;!-- Configuration for production environment --&gt;
&lt;!-- Note: --&gt;
&lt;!-- 1. Set local-mode false to activate remote mode. --&gt;
&lt;!-- 2. If machine is job-machine, set job-machine true, you just need config only one machine. Job is offline for report aggreation, statistics report.--&gt;
&lt;!-- 3. If machine is alert-machine, set alert-machine true, you just need config only one machine. --&gt;
&lt;!-- 4. Cat can run without hdfs, you just config hdfs-machine false. If you have hdfs, you can config hdfs info for saving the logview info.  --&gt;
&lt;!-- 5. If you don't need hdfs, the logview will be stored in local disk. You can config max local-logivew-storage-time for cleaning up old logview, the unit is day. --&gt;
&lt;!-- 6. Please set hadoop environment accordingly. --&gt;
&lt;!-- 7. Please set ldap info for login the system. --&gt;
&lt;!-- 8. Please config remote-server if you have many cat servers. --&gt;
&lt;config local-mode="false" hdfs-machine="false" job-machine="false" alert-machine="false"&gt;
  &lt;storage  local-base-dir="/data/appdatas/cat/bucket/" max-hdfs-storage-time="15" local-report-storage-time="7" local-logivew-storage-time="7"&gt;
    &lt;hdfs id="logview" max-size="128M" server-uri="hdfs://10.1.77.86/user/cat" base-dir="logview"/&gt;
    &lt;hdfs id="dump" max-size="128M" server-uri="hdfs://10.1.77.86/user/cat" base-dir="dump"/&gt;
    &lt;hdfs id="remote" max-size="128M" server-uri="hdfs://10.1.77.86/user/cat" base-dir="remote"/&gt;
  &lt;/storage&gt;
  &lt;console default-domain="Cat" show-cat-domain="true"&gt;
    &lt;remote-servers&gt;10.1.1.1:8080,10.1.1.2:8080,10.1.1.3:8080&lt;/remote-servers&gt;    
    &lt;/console&gt;
  &lt;ldap ldapUrl="ldap://192.168.50.11:389/DC=dianpingoa,DC=com"/&gt;
 &lt;/config&gt;
        </pre>
        <li>
          <p>启动一台服务端10.1.1.1，修改服务端路由文件，url地址 http://10.1.1.1:8080/cat/s/config?op=routerConfigUpdate</p>
          <p>需要用户名密码登陆，如果配置ldap即可直接登陆，或者用默认账号catadmin/catadmin登陆。</p>
          <p>可以将10.1.1.1 部署为提供内部访问，并设置job-machine=true，alert-machine=true，让这台机器进行后续job以及告警处理，这些都可能影响到consumer性能。</p>
          <p>将10.1.1.2,10.1.1.3 处理全部监控请求，如果后续需要扩容，可以直接添加default-server的节点。</p>
        </li>
        <pre class="hljs scala">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;router-config backup-server="10.1.1.1" backup-server-port="2280"&gt;
   &lt;default-server id="10.1.1.2" port="2280" enable="true"/&gt;
   &lt;default-server id="10.1.1.3" port="2280" enable="true"/&gt;
&lt;/router-config&gt;
        </pre>
        <li>客户端集成，请参考集成文档</li>
      </ol>
    </section>
  </div>
 
</div>
<!-- ./wrapper -->

<script src="../plugins/jQuery/jQuery-2.2.0.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="../bootstrap/js/bootstrap.min.js"></script>
<!-- AdminLTE App -->
<script src="../dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../dist/js/demo.js"></script>

</body>
</html>
