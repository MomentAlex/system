<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>浏览器监控-文档</title>
 <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../dist/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="../dist/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../dist/css/AdminLTE.css">
  <link rel="stylesheet" href="../dist/css/common.css">
  <link rel="stylesheet" href="../dist/css/skins/_all-skins.min.css">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="../dist/js/html5shiv.js"></script>
  <script src="../dist/js/respond.min.js"></script>
  <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <header class="main-header">
    <!-- Logo -->
    <a href="index.html" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini">BL</span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg">日志系统</span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
      </a>
     <ul class="nav navbar-nav log-menu">
            <li>
              <a href="../index.html" target="_self">
                <button class="btn btn-block btn-success btn-flat" id="nav_application">
                  <i class="fa fa-signal"></i>应用
                </button>
              </a>
            </li>
            <li>
              <a href="../Mobile/mobile.html">
                <button class="btn btn-block btn-flat btn-twitter" id="nav_mobile">
                  <i class="menu-icon glyphicon glyphicon-phone"></i>移动
                </button>
              </a>
            </li>
            <li>
              <a href="../Browser/browser.html">
                <button class="btn btn-block btn-flat btn-warning" id="nav_browser">
                  <i class="fa fa-users"></i>浏览器
                </button>
              </a>
            </li>
            <li>
              <a href="../Servers/servers.html">
                <button class="btn btn-block btn-flat bg-purple" id="nav_server">
                  <i class="fa fa-cogs"></i>服务器
                </button>
              </a>
            </li>
            <li>
              <a href="../configs/configs.html">
                <button class="btn btn-block btn-flat bg-navy" id="nav_config">
                  <i class="fa fa-fw fa-adjust"></i>配置
                </button>
              </a>
            </li>
            <li class="active">
              <a href="documents.html">
                <button class="btn btn-block btn-flat bg-aqua" id="nav_document">
                  <i class="fa fa-fw fa-database"></i>文档
                </button>
              </a>
            </li>
          </ul>
      <div class="pull-right">
        <a class="log-exit"><i class="fa fa-sign-out"></i></a>
      </div>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- Sidebar user panel -->
      <div class="user-panel">
        <div class="pull-left image">
          <img src="../dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
        </div>
        <div class="pull-left info">
          <p>亚历山大·皮尔斯</p>
          <a href="#"><i class="fa fa-circle text-success"></i> 在线</a>
        </div>
      </div>
      
      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu">
        <li class="header">主导航</li>
         <li class="treeview">
          <a href="documents.html">
            <i class="glyphicon glyphicon-home"></i> <span>项目首页</span> 
          </a>
        </li>
        <li class="treeview">
          <a href="version-description.html">
            <i class="glyphicon glyphicon-book"></i>
            <span>版本说明</span>
          </a>
        </li>
        <li class="treeview">
          <a href="documents-deployment.html">
            <i class="fa fa-cogs"></i>
            <span>部署文档</span>
          </a>
        </li>
        <li class="treeview">
          <a href="documents-integrated.html">
            <i class="fa fa-cutlery"></i>
            <span>集成文档</span>
          </a>
        </li>
         <li class="treeview">
          <a href="application-monitoring.html">
            <i class="fa fa-users"></i>
            <span>应用监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="mobile-monitor.html">
            <i class="glyphicon glyphicon-phone"></i>
            <span>移动监控</span>
          </a>
        </li>
        <li class="active treeview">
          <a href="browser-monitor.html">
            <i class="fa fa-globe"></i>
            <span>浏览器监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="server-monitor.html">
            <i class="fa fa-desktop"></i>
            <span>服务端监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="alarm-document.html">
            <i class="fa fa-bell"></i>
            <span>告警文档</span>
          </a>
        </li>
        <li class="treeview">
          <a href="interface-document.html">
            <i class="glyphicon glyphicon-align-left"></i>
            <span>接口文档</span>
          </a>
        </li>
        <li class="treeview">
          <a href="developer-document.html">
            <i class="glyphicon glyphicon-refresh"></i>
            <span>开发者文档</span>
          </a>
        </li>
         <li class="treeview">
          <a href="common-problem.html">
            <i class="fa fa-inbox"></i>
            <span>常见问题</span>
          </a>
        </li>
         <li class="treeview">
          <a href="plug-in.html">
            <i class="fa fa-key"></i>
            <span>插件扩展</span>
          </a>
        </li>

      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        浏览器监控
        <small>Browser Monitor</small>
      </h1>
    </section>
    <!-- Main content -->
    <section class="content">
      <div class="nav-tabs-custom">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#report" data-toggle="tab">web访问</a></li>
          <li><a href="#interface" data-toggle="tab">接口文档</a></li>
          <li><a href="#alert" data-toggle="tab">JS告警配置</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active document" id="report">
              <h4 class="text-danger">1、Browser使用说明&nbsp;&nbsp;&nbsp;&nbsp; <a href="../r/browser">访问链接</a></h4>
              <p>监控点评Web页面的ajax的接口调用情况，这个是从用户Web浏览器采集的数据，从用户角度看点评接口的访问速度。</p>
              <p>分析的维度有地区、运营商等。</p>
              <p>此部分需要前端框架cortext配合，进行前端打点。</p>
              <br />
              <p>Sample：下图显示了shopweb-suggestShop一段时间的访问情况。</p>
              <img width='80%' src="../images/userMonitor02.png" />
              <br />
              <br />
              <h4 class="text-danger">2、配置&nbsp;&nbsp;&nbsp;&nbsp; <a href="">访问链接</a> </h4>
              <img width='80%' src="../images/userMonitor04.png" />
              <br />
              <br />
              <h4 class="text-danger">3、告警&nbsp;&nbsp;&nbsp;&nbsp; <a href="">访问链接</a> </h4>
              <h5 class="text-success">A) 配置一览表</h5>
              <img width='80%' src="../images/userMonitor08.png" />
              <h5 class="text-success">B) 配置告警规则</h5>
              <p>（1）告警名自定义，方便区分告警项。可对<span class="text-danger">请求数、访问成功率、响应时间</span>进行监控。</p>
              <p>（2）多个监控规则构成了告警的主体，分别对不同时间段进行配置，以方便准确地进行告警。</p>
              <p>（3）监控规则诠释着某个时间段内如何进行告警，由任意多个监控条件组成。任何一条监控条件触发都会引起监控规则触发，从而告警。</p>
              <p>（4）监控条件诠释着什么条件会触发监控规则，由任意多个监控子条件组成。当所有子条件同时被触发时，才会触发该监控规则。</p>
              <img width='80%' src="../images/userMonitor09.png" />
          </div>
          <div class="tab-pane document" id="interface">
    <h4 class="text-danger">用户端监控文档</h4>
    <h5 class="text-info"> a).从用户端角度来看点评的业务接口状态，这是一个端到端的监控，能最早的发现用户端出现问题，比如根本访问不到点评，某城市延迟很大等。</h5>
    <h5 class="text-info"> b).用户端的监控目前能监控Ajax接口，页面Page不能监控到。</h5>
    <h5 class="text-info"> c).一般一个应用会监控1-2个重要接口，后端实时分析会按照城市、运营商维度做一些聚合分析。</h5>
    <br/>
    <h4>外部监控API文档</h4>
    <p>用途：提供外部监控的Http接口，用于监控用户端的错误信息。</p>
    <p>1、为了保留以后的扩展性，移动端和Web端的暂定用不同的API接口。</p>
    <p class="text-danger">2、公网IP，221.181.67.144 文档后面{ip}使用这个。</p>
    <br/>
    <h4 class="text-danger">Web单次接口</h4>
    <pre> http://{ip}/web-broker-service/api/ajax</pre>
    <p>参数说明</p>
    <table style="width:70%" class="table table-bordered table-striped table-condensed  ">
        <tr>
            <th>query名</th>
            <th>实际名称</th>
            <th>描述</th>
            <th>类型</th>
        </tr>
        <tr>
            <td>v</td>
            <td>version</td>
            <td>API版本号</td>
            <td>暂定为1</td>
        </tr>
        <tr>
            <td>ts</td>
            <td>timestamp</td>
            <td>发生时间</td>
            <td>long型，1970到现在的毫秒数</td>
        </tr>
        <tr>
            <td>tu</td>
            <td>targetUrl</td>
            <td>调用的URL或API</td>
            <td>String</td>
        </tr>
        <tr>
            <td>d</td>
            <td>duration</td>
            <td>访问耗时</td>
            <td>long 毫秒</td>
        </tr>
        <tr>
            <td>c</td>
            <td>code</td>
            <td>返回结果码</td>
            <td>整型</td>
        </tr>
        <tr>
            <td>s</td>
            <td>requestByte</td>
            <td>发送字节数</td>
            <td>整型，以byte为单位</td>
        </tr>
        <tr>
            <td>r</td>
            <td>responseByte</td>
            <td>返回字节数</td>
            <td>整型，以byte为单位</td>
        </tr>
        <tr>
            <td>n</td>
            <td>network</td>
            <td>网络类型</td>
            <td>整型, 2G,3G,4G,WIFI(iOS只有3G和WIFI)，1=wifi, 2=2G, 3=3G, 4=4G, 0=Unknown</td>
        </tr>
    </table>
    <br/>
    <br/>
    <h4 class="text-danger">JS 错误上报接口</h4>
    <pre> http://{ip}/web-broker-service/api/js</pre>
    <p>参数说明</p>
    <table style="width:70%" class="table table-bordered table-striped table-condensed  ">
        <tr>
            <th>query名</th>
            <th>实际名称</th>
            <th>描述</th>
            <th>类型</th>
        </tr>
        <tr>
            <td>v</td>
            <td>version</td>
            <td>API版本号</td>
            <td>暂定为1</td>
        </tr>
        <tr>
            <td>t</td>
            <td>timestamp</td>
            <td>发生时间</td>
            <td>long型，1970到现在的毫秒数</td>
        </tr>
        <tr>
            <td>msg</td>
            <td>message</td>
            <td>错误的类型,简要信息</td>
            <td>String</td>
        </tr>
        <tr>
            <td>n</td>
            <td>appName</td>
            <td>错误的发生的应用模块</td>
            <td>String</td>
        </tr>
        <tr>
            <td>l</td>
            <td>level</td>
            <td>错误等级</td>
            <td>String,包括ERROR,WARN,INFO,DEV</td>
        </tr>
        <tr>
            <td>a</td>
            <td>agent</td>
            <td>浏览器信息</td>
            <td>String</td>
        </tr>
        <tr>
            <td>id</td>
            <td>dpid</td>
            <td>用户ID，用于搜索错误日志</td>
            <td>String</td>
        </tr>
        <tr>
            <td>data</td>
            <td>data</td>
            <td>详细出错信息</td>
            <td>String，如果没有的话，传空串</td>
        </tr>
    </table>
    <br/>
    <h4 class="text-danger">Web原始日志上报接口</h4>
    <pre> http://{ip}/web-broker-service/api/log</pre> 批量接口POST内容，前面加上v=1&c=，不同请求之间用回车
    <span class="text-danger">ENTER</span>分隔，字段之间用<span class="text-danger">TAB</span>分隔。
    <pre>
  timstamp<span class="text-danger">TAB</span>level<span class="text-danger">TAB</span>requestId<span class="text-danger">TAB</span>appName<span class="text-danger">TAB</span>url<span class="text-danger">TAB</span>message<span class="text-danger">ENTER</span>
  
  sample如下:
  
  v=1&c=
  1400037748182<span class="text-danger">TAB</span>ERROR<span class="text-danger">TAB</span>11233333<span class="text-danger">TAB</span>shopInfo<span class="text-danger">TAB</span>url1<span class="text-danger">TAB</span>test1<span class="text-danger">ENTER</span>
  1400037748182<span class="text-danger">TAB</span>INFO<span class="text-danger">TAB</span>22339283<span class="text-danger">TAB</span>shopInfo<span class="text-danger">TAB</span>url2<span class="text-danger">TAB</span>test2<span class="text-danger">ENTER</span>
  1400037748182<span class="text-danger">TAB</span>WARN<span class="text-danger">TAB</span>13456664<span class="text-danger">TAB</span>shopInfo<span class="text-danger">TAB</span>url3<span class="text-danger">TAB</span>test3<span class="text-danger">ENTER</span>
  </pre>
    <p class="text-danger">v=1&c=不需要做urlencode,后面的批量的content部分需要urlencode。</p>
    <p>参数说明</p>
    <table style="width:70%" class="table table-bordered table-striped table-condensed  ">
        <tr>
            <th>实际名称</th>
            <th>描述</th>
            <th>类型</th>
        </tr>
        <tr>
            <td>v</td>
            <td>API版本号</td>
            <td>暂定为1</td>
        </tr>
        <tr>
            <td>c</td>
            <td>具体内容</td>
            <td>content内容</td>
        </tr>
    </table>
    <p>content内容说明</p>
    <pre>
  timestamp<span class="text-danger">TAB</span>level<span class="text-danger">TAB</span>requestId<span class="text-danger">TAB</span>appName<span class="text-danger">TAB</span>Url<span class="text-danger">TAB</span>message<span class="text-danger">ENTER</span>
  </pre>
    <table style="width:70%" class="table table-bordered table-striped table-condensed  ">
        <tr>
            <th>实际名称</th>
            <th>描述</th>
            <th>类型</th>
        </tr>
        <tr>
            <td>timestamp</td>
            <td>发生时间</td>
            <td>long型，1970到现在的毫秒数</td>
        </tr>
        <tr>
            <td>level</td>
            <td>log等级</td>
            <td>DEV,INFO,WARN,ERROR</td>
        </tr>
        <tr>
            <td>requestId</td>
            <td>用户id</td>
            <td>String</td>
        </tr>
        <tr>
            <td>appName</td>
            <td>应用名</td>
            <td>String</td>
        </tr>
        <tr>
            <td>Url</td>
            <td>请求访问的URL</td>
            <td>String</td>
        </tr>
        <tr>
            <td>message</td>
            <td>日志信息</td>
            <td>String</td>
        </tr>
    </table>
    <br/>
    <h4 class="text-danger">Web测速上报接口</h4>
    <pre> http://{ip}/web-broker-service/api/speed</pre>
    <p>参数说明</p>
    <table style="width:90%" class="table table-bordered table-striped table-condensed  ">
        <tr>
            <th style="width:10%">query名</th>
            <th style="width:15%">实际名称</th>
            <th style="width:15%">描述</th>
            <th style="width:60%">类型</th>
        </tr>
        <tr>
            <td>v</td>
            <td>version</td>
            <td>API版本号</td>
            <td>暂定为1</td>
        </tr>
        <tr>
            <td>t</td>
            <td>timestamp</td>
            <td>发生时间</td>
            <td>long型，1970到现在的毫秒数</td>
        </tr>
        <tr>
            <td>n</td>
            <td>network</td>
            <td>网络类型</td>
            <td>整型, 2G,3G,4G,WIFI(iOS只有3G和WIFI)，1=wifi, 2=2G, 3=3G, 4=4G, 0=Unknown</td>
        </tr>
        <tr>
            <td>p</td>
            <td>platform</td>
            <td>平台类型</td>
            <td>整型</td>
        </tr>
        <tr>
            <td>source</td>
            <td>source</td>
            <td>来源</td>
            <td>整型</td>
        </tr>
        <tr>
            <td>w</td>
            <td>page</td>
            <td>web页面id，可于配置页面查询</td>
            <td>整型</td>
        </tr>
        <tr>
            <td>speedparams</td>
            <td>测速点</td>
            <td>详细测速信息</td>
            <td>以测速点编号-时间为一个单元，每个测速点之间以\t分隔， step1-responseTime1<span class="text-danger">TAB</span>step2-responseTime2...,例如1-1\t2-10\t3-100表明编号为1的测速点加载时间1毫秒，编号为2的测速点，加载时间10毫秒...</td>
        </tr>
    </table>
    <br/>
    <h4 class="text-danger">Web测速 日报表数据获取接口</h4> 1.测速点获取
    <pre> http://cat.dp/cat/r/browser?op=speedConfigFetch&type={type}</pre> type可为xml或json,分别返回相应格式的数据。
    <br/> json数据示例：
    <pre>
{
    "speeds": {
        "1": {
            "id": 1,
            "page": "testpage",
            "steps": {
                "1": {
                    "id": 1,
                    "title": "unloadEventStart"
                },
                "2": {
                    "id": 2,
                    "title": "unloadEventEnd"
                }
            }
        },
        "2": {
            "id": 2,
            "page": "homepage",
            "steps": {
                "1": {
                    "id": 1,
                    "title": "unloadEventStart"
                },
                "2": {
                    "id": 2,
                    "title": "unloadEventEnd"
                }   
            }
        }
    }
}
</pre> 2.数据获取
    <pre> http://cat.dp/cat/r/browser?op=speedJson&query1={query}</pre> query条件如下：
    <pre>
{date};{page};{stepId};{network};{platform};{city};{operator};{source}

date格式为'YYYY-MM-DD'
page由pageId和pageName组成，中间用竖线"|"分隔
stepId为测速点ID
network、platform、city、operator、source均为整型，具体数值含义见 http://cat.dp/cat/s/web?op=webConstants,不传默认为查询全部数据
</pre> 示例：
    <pre>
http://cat.dp/cat/r/browser?op=speedJson&query1=2015-11-25;1|testpage;1;;;;;
该示例表明查询2015年11月25日,pageId为1，pageName为testpage，测速点编号为1的测速点数据。

返回数据示例如下：
{
    "webSpeedSummarys": {
        "当前值": {
            "period": "2015-11-25 00:00:00",
            "minuteOrder": 0,
            "accessNumberSum": 781,
            "responseTimeAvg": 2.381562099871959
        }
    },
    "webSpeedDetails": {
        "当前值": [
            {
                "period": "2015-11-25 00:00:00",
                "minuteOrder": 0,
                "accessNumberSum": 30,
                "responseTimeAvg": 1.6
            },
            {
                "period": "2015-11-25 00:00:00",
                "minuteOrder": 5,
                "accessNumberSum": 39,
                "responseTimeAvg": 3.3076923076923075
            }
          ...
        ]
    }
}
</pre> webSpeedSummarys中为当天数据的聚合值，webSpeedDetails中存放一天中每五分钟的速度均值。
    <br/>
</div>
     <div class="tab-pane document" id="alert">
        <h4 class="text-success">前端JS告警</h4>
        <h5>前端JS告警监控JavaScript运行状况。</h5>
        <h5>当某一个页面上js运行抛出的Error总数超过设定的阈值时，发出告警信息。</h5>
        <br/>
        <h4 class="text-success">监控规则配置</h4>
        <p>为了满足监控的需求，前端JS监控规则没有采用通用的规则模型。其配置如下：</p>
        <img width='60%' src="../images/frontendException.png" />
        <p>各个参数含义如下</p>
        <p><span class="text-danger">[模块名称]</span>：JS告警的业务模块</p>
        <p><span class="text-danger">[报错等级]</span>：JS错误的等级</p>
        <p><span class="text-danger">[告警阈值]</span>：在一分钟内js抛出error个数的上限值。超过这个值就会发出告警</p>
        <p><span class="text-danger">[联系人邮件]</span>：告警联系人。多个联系人请用，分开</p>
        <br/>
        <h4 class="text-success">规则更新</h4>
        <p>1).点击config－－JS告警－－进入前端JS监控规则配置页面。</p>
        <p>2).点击新增按钮或者选取已有网址的编辑按钮，按照上述介绍对规则进行配置并提交，如果列表页面已更新，则表示规则已经生效。</p>
        <br/>
        <h4 class="text-success">告警策略配置</h4>
        <p>1).点击导航栏Config－－监控告警配置－－告警类型设置</p>
        <p>2).编辑id为Js的type元素</p>
        <p>&nbsp;&nbsp;&nbsp;&nbsp;只有一个group元素，其id为Js。请不要再添加其它group元素</p>
        <p>&nbsp;&nbsp;&nbsp;&nbsp;对group下的level元素进行编辑</p>
        <p>&nbsp;&nbsp;&nbsp;&nbsp;send属性可为mail,weixin,sms</p>
        <p>3).当出现"操作成功"提示时表明策略已经生效</p>
    </div>
        </div>
      </div>
    </section>
  </div>
 
</div>
<!-- ./wrapper -->

<script src="../plugins/jQuery/jQuery-2.2.0.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="../bootstrap/js/bootstrap.min.js"></script>
<!-- AdminLTE App -->
<script src="../dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../dist/js/demo.js"></script>

</body>
</html>
