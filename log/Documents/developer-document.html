<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>开发者文档-文档</title>
 <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../dist/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="../dist/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../dist/css/AdminLTE.css">
  <link rel="stylesheet" href="../dist/css/common.css">
  <link rel="stylesheet" href="../dist/css/skins/_all-skins.min.css">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="../dist/js/html5shiv.js"></script>
  <script src="../dist/js/respond.min.js"></script>
  <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <header class="main-header">
    <!-- Logo -->
    <a href="index.html" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini">BL</span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg">日志系统</span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
      </a>
     <ul class="nav navbar-nav log-menu">
            <li>
              <a href="../index.html" target="_self">
                <button class="btn btn-block btn-success btn-flat" id="nav_application">
                  <i class="fa fa-signal"></i>应用
                </button>
              </a>
            </li>
            <li>
              <a href="../Mobile/mobile.html">
                <button class="btn btn-block btn-flat btn-twitter" id="nav_mobile">
                  <i class="menu-icon glyphicon glyphicon-phone"></i>移动
                </button>
              </a>
            </li>
            <li>
              <a href="../Browser/browser.html">
                <button class="btn btn-block btn-flat btn-warning" id="nav_browser">
                  <i class="fa fa-users"></i>浏览器
                </button>
              </a>
            </li>
            <li>
              <a href="../Servers/servers.html">
                <button class="btn btn-block btn-flat bg-purple" id="nav_server">
                  <i class="fa fa-cogs"></i>服务器
                </button>
              </a>
            </li>
            <li>
              <a href="../configs/configs.html">
                <button class="btn btn-block btn-flat bg-navy" id="nav_config">
                  <i class="fa fa-fw fa-adjust"></i>配置
                </button>
              </a>
            </li>
            <li class="active">
              <a href="documents.html">
                <button class="btn btn-block btn-flat bg-aqua" id="nav_document">
                  <i class="fa fa-fw fa-database"></i>文档
                </button>
              </a>
            </li>
          </ul>
      <div class="pull-right">
        <a class="log-exit"><i class="fa fa-sign-out"></i></a>
      </div>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- Sidebar user panel -->
      <div class="user-panel">
        <div class="pull-left image">
          <img src="../dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
        </div>
        <div class="pull-left info">
          <p>亚历山大·皮尔斯</p>
          <a href="#"><i class="fa fa-circle text-success"></i> 在线</a>
        </div>
      </div>
      
      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu">
        <li class="header">主导航</li>
         <li class="treeview">
          <a href="documents.html">
            <i class="glyphicon glyphicon-home"></i> <span>项目首页</span> 
          </a>
        </li>
        <li class="treeview">
          <a href="version-description.html">
            <i class="glyphicon glyphicon-book"></i>
            <span>版本说明</span>
          </a>
        </li>
        <li class="treeview">
          <a href="documents-deployment.html">
            <i class="fa fa-cogs"></i>
            <span>部署文档</span>
          </a>
        </li>
        <li class="treeview">
          <a href="documents-integrated.html">
            <i class="fa fa-cutlery"></i>
            <span>集成文档</span>
          </a>
        </li>
         <li class="treeview">
          <a href="application-monitoring.html">
            <i class="fa fa-users"></i>
            <span>应用监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="mobile-monitor.html">
            <i class="glyphicon glyphicon-phone"></i>
            <span>移动监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="browser-monitor.html">
            <i class="fa fa-globe"></i>
            <span>浏览器监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="server-monitor.html">
            <i class="fa fa-desktop"></i>
            <span>服务端监控</span>
          </a>
        </li>
        <li class="treeview">
          <a href="alarm-document.html">
            <i class="fa fa-bell"></i>
            <span>告警文档</span>
          </a>
        </li>
        <li class="treeview">
          <a href="interface-document.html">
            <i class="glyphicon glyphicon-align-left"></i>
            <span>接口文档</span>
          </a>
        </li>
        <li class="active treeview">
          <a href="developer-document.html">
            <i class="glyphicon glyphicon-refresh"></i>
            <span>开发者文档</span>
          </a>
        </li>
         <li class="treeview">
          <a href="common-problem.html">
            <i class="fa fa-inbox"></i>
            <span>常见问题</span>
          </a>
        </li>
         <li class="treeview">
          <a href="plug-in.html">
            <i class="fa fa-key"></i>
            <span>插件扩展</span>
          </a>
        </li>

      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        开发者文档
        <small>Developer Documentation</small>
      </h1>
    </section>

    <!-- Main content -->
    <section class="content">
     <div class="box box-primary">
        <div class="box-body document">
          <dl>
              <dt>
                  <h5 class="text-success">1.CAT消息协议</h5></dt>
              <dd>CAT客户端可以向服务端发送Transaction, Event, Heartbeat三种消息. 消息的传输格式如下:
                  <pre>Class Timestamp Type Name Status Duration Data</pre>
                  <p>下例是某个实际传输的heartbeat消息:</p>
                  <pre>H2012-04-26 16:00:42.775 Heartbeat 192.168.63.141 0
&lt;os name="Mac OS X" arch="x86_64" version="Mac OS X" /&gt;</pre>
                  <table class="table table-striped table-condensed ">
                      <tr>
                          <td class="text-info">Timestamp</td>
                          <td>记录消息产生的时刻, 格式"yyyy-mm-dd HH:MM:SS.sss".</td>
                      </tr>
                      <tr>
                          <td class="text-info">Type</td>
                          <td>大小写敏感的字符串. 常见的Transaction type有 "URL", "SQL", "Email", "Exec"等. 常见的Event type有 "Info", "Warn", "Error", 还有"Cat"用来表示Cat内部的消息.</td>
                      </tr>
                      <tr>
                          <td class="text-info">Name</td>
                          <td>大小写敏感的字符串. type和name的组合要满足全局唯一性. 常见的URL transaction type的name如 "ViewItem", "MakeBid", "SignIn"等. SQL transaction type的name如 "AddFeedback", "GetAccountDetailUnit4", "IncrementFeedbackAndTotalScore"等.</td>
                      </tr>
                      <tr>
                          <td class="text-info">Status</td>
                          <td>大小写敏感的字符串. 0表示成功, 非零表示失败. 建议不要使用太长的字符串. Transaction start没有status字段.</td>
                      </tr>
                      <tr>
                          <td class="text-info">Duration</td>
                          <td>精确到0.1毫秒. 表示transaction start和transaction end之间的时间长度. 仅出现在Transaction end或者Atomic Transaction. Event和Heartbeat没有duration字段.</td>
                      </tr>
                      <tr>
                          <td class="text-info">Data</td>
                          <td>建议使用以&字符分割的name=value对组成的字符串列表. Transaction start没有data字段.</td>
                      </tr>
                  </table>
              </dd>
              <dt>
                  <h5 class="text-success">2.Transaction</h5></dt>
              <dd>
                  <p class="text-danger">a).transaction适合记录跨越系统边界的程序访问行为，比如远程调用，数据库调用，也适合执行时间较长的业务逻辑监控</p>
                  <p>b).某些运行期单元要花费一定时间完成工作, 内部需要其他处理逻辑协助, 我们定义为Transaction.</p>
                  <p>c).Transaction可以嵌套(如http请求过程中嵌套了sql处理). </p>
                  <p>d).大部分的Transaction可能会失败, 因此需要一个结果状态码. </p>
                  <p>e).如果Transaction开始和结束之间没有其他消息产生, 那它就是Atomic Transaction(合并了起始标记).</p>
                  <imgages src="../imgages/transactionGuide.jpg" />
                  <br/>
                  <p><strong class="text-info">Transaction API</strong></p>
                  <pre>
              com.dianping.cat.message.MessageProducer:
              Transaction newTransaction(String type, String name);
              com.dianping.cat.message.Transaction:
              void addData(String keyValuePairs);
              void addData(String key, Object value);
              void setStatus(String status);
              void complete();
          </pre>
                  <p><strong class="text-info">代码示例</strong></p>
                  <pre>
Transaction t = Cat.getProducer().newTransaction("your transaction type", "your transaction name"); try { yourBusinessOperation(); Cat.getProducer().logEvent("your event type", "your event name", Event.SUCCESS, "keyValuePairs") t.setStatus(Transaction.SUCCESS); } catch (Exception e) { Cat.getProducer().logError(e);//用log4j记录系统异常，以便在Logview中看到此信息 t.setStatus(e); throw e; (CAT所有的API都可以单独使用，也可以组合使用，比如Transaction中嵌套Event或者Metric。) (注意如果这里希望异常继续向上抛，需要继续向上抛出，往往需要抛出异常，让上层应用知道。) (如果认为这个异常在这边可以被吃掉，则不需要在抛出异常。) } finally { t.complete(); }
                  </pre>
              </dd>
              <dt>
                  <h5 class="text-success">3.Event</h5></dt>
              <dd>Event用来记录次数，表名单位时间内消息发生次数，比如记录系统异常，它和transaction相比缺少了时间的统计，开销比transaction要小</dd>
              <dt>
                  <h5 class="text-success">4.Metric</h5></dt>
              <h5 class='text-danger'> Metric一共有三个API，分别用来记录次数、平均、总和，统一粒度为一分钟</h5>
              <p>1).logMetricForCount用于记录一个指标值出现的次数</p>
              <p>2).logMetricForDuration用于记录一个指标出现的平均值</p>
              <p>3).logMetricForSum用于记录一个指标出现的总和</p>
              <p>4).修改指标一些图形描述信息，请到<a href="/cat/s/config?op=metricConfigList">Config进行配置</a></p>
              <dt>
                  <h5 class="text-success">5.Heartbeat<span class="text-danger"><strong>  这个是系统CAT客户端使用，应用程序不使用此API.</strong></span></h5></dt>
              <dd>Heartbeta表示程序内定期产生的统计信息, 如CPU%, MEM%, 连接池状态, 系统负载等。</dd>
              <dt>
                  <h5 class="text-success">6.一份埋点的样例</strong></span></h5></dt>
              <h5>Transaction用来记录一段程序响应时间</h5>
              <h5>Event用来记录一行code的执行次数</h5>
              <h5>Metric用来记录一个业务指标</h5>
              <h5 class="text-danger">这些指标都是独立的，可以单独使用，主要看业务场景。</h5>
              <h5 class="text-success">下面的埋点代码里面表示需要记录一个页面的响应时间，并且记录一个代码执行次数，以及记录两个业务指标,所有用了一个Transaction，一个Event，两个Metric</strong></span></h5>
              <h5 class="text-danger">Transaction的埋点一定要complete，切记放在finally里面。</h5>
              <img width='60%' src="../images/develop05.png" />
          </dl>

        </div>
     </div>
    </section>
  </div>
 
</div>
<!-- ./wrapper -->

<script src="../plugins/jQuery/jQuery-2.2.0.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="../bootstrap/js/bootstrap.min.js"></script>
<!-- AdminLTE App -->
<script src="../dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../dist/js/demo.js"></script>

</body>
</html>
